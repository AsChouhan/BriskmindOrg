@isTest
private class BatchEmailDigestTest {
    private static Simpplr_Site__c siteObj;
    private static Simpplr_Content__c contentObj;
    private static CollaborationGroup cg;
    private static CollaborationGroupMember cgmObj;
    Private static People__c peopleObj;
    Private static User testUser;
    @testSetup static void setup() {
	   TestHelper.setupAppConfig();
       TestHelper.setupAppDefault(); 
       testUser = TestHelper.createUser('BatchEmailDigestTest_usr1', null, false);
       peopleObj = TestHelper.createPeopleRecordForUser(UserContext.id);
       cg=TestHelper.createCollaborationGroup('BatchEmailDigestTest','Public');
       siteObj = TestHelper.getSiteRecord(cg.id);
       TestHelper.shareSitesToAllPeople(new List<String>{siteObj.Id});
       cgmObj = TestDataHandler.createCollaborationGroupMember(cg.id ,peopleObj.Id);
       contentObj = TestHelper.createContent('simpplr test Album', 'Album', 'Approved', testUser, siteObj);
       TestHelper.createPeoplePreference(peopleObj.id) ;
    }
    
   private static Simpplr_Site__c getSimpplrSite(){
    	 return([select id,Name from Simpplr_Site__c limit 1]);
    }
    
   static void init() {
        siteObj = [select id, Chatter_Group_Id__c from Simpplr_Site__c where name='BatchEmailDigestTest' limit 1];
        contentObj = [select id from Simpplr_Content__c where Type__c='Album' AND title__c =: 'simpplr test Album' limit 1];
      
    }
	@isTest static void testBatchEmailDigest1(){
        Test.startTest();    
		Simpplr_Content__c contentObj1 = [select id from Simpplr_Content__c where title__c ='simpplr test Album' limit 1];
        testUser = [select id from User where lastName='BatchEmailDigestTest_usr1' limit 1];
        peopleObj = [select id From People__c where User__c =:testUser.Id limit 1];
        cg = [select id from CollaborationGroup where name='BatchEmailDigestTest' limit 1];
		FeedItem feedItem = TestDataHandler.createFeedItem(cg.id,'PollPost');
        FeedComment feedComment = TestDataHandler.createFeedComment(feedItem.Id);
        Feed_Cache__c feedCacheObj = new Feed_Cache__c();
        feedCacheObj.parent_Id__c = cg.id;
        feedCacheObj.Mention_1__c = peopleObj.id;
        feedCacheObj.Feed_Id__c = feedItem.id;
		feedCacheObj.Feed_Data__c ='{"actor":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0F96A000000UH93SAG","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"testPhotoUrl","photoVersionId":"testPhotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","additionalLabel":"Archived","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","name":"Anubhav Gupta","reputation":null,"title":null,"type":"User"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"  ","type":"posted a file."},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Archived"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Private"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Unlisted"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"aaa"},"canShare":true,"capabilities":{"associatedActions":{"platformActionGroups":[]},"files":{"items":[{"id":"'+contentObj1.id+'","url":"https://c.na136"}]},"link":{"url":"https://c.na136","urlName":"newURL"},"poll":{"totalVoteCount":1,"choices":[{"id":"testId","position":1,"text":"testText","voteCount":1,"voteCountRatio":1}]},"content":{"downloadUrl":"testDownloaadUrl","fileExtension":".txt","fileSize":"22","fileType":"text","id":"contentTestId","title":"testTitle"},"bookmarks":{"isBookmarkedByCurrentUser":false},"chatterLikes":{"isLikedByCurrentUser":false,"likesMessage":null,"myLike":null,"page":{"currentPageToken":0,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/chatter-likes/items","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0}},"comments":{"page":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/comments/items","items":[{"user":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"teststandardEmailPhotoUrl","photoVersionId":"testphotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"posted a file.","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Archived","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Unlisted","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Private","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Private","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"tag":"Google","text":"#Google","topicUrl":"/services/data/v36.0/connect/topics?q=Google&exactMatch=true","type":"Hashtag","url":"/services/data/v36.0/chatter/feed-elements?q=%23Google"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"hey there goog [Crossed-out text: work] @Anubhav Gupta  @Site Admin  #Google- aa- bb- cc- dd"},"capabilities":{"content":{"checksum":"f721d878ca69178d3aa198a7bbb93ffb","contentUrl":null,"description":null,"downloadUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/download/0686A000002ONOn?asPdf=false&operationContext=CHATTER","fileExtension":"jpg","fileSize":"128749","fileType":"Image - jpg","hasPdfPreview":false,"id":"0696A000002JpVaQAK","isInMyFileSync":false,"mimeType":"image/jpeg","renditionUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB120BY90&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl240By180":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB240BY180&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl720By480":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB720BY480&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","sharingOption":"Allowed","textPreview":null,"thumb120By90RenditionStatus":"Processing","thumb240By180RenditionStatus":"Processing","thumb720By480RenditionStatus":"Processing","title":"Lenovo-p780-camera-sample-10.jpg","versionId":"0686A000002ONOnQAO"},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null}},"clientInfo":null,"createdDate":"2018-06-26T08:57:27.000Z","feedElement":{"id":"0D56A00000aUXm2SAG","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG"},"id":"0D76A0000009csNSAQ","isDeleteRestricted":false,"likes":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/likes","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0},"likesMessage":null,"moderationFlags":null,"myLike":null,"parent":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"relativeCreatedDate":"Just now","type":"ContentComment","url":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ"}],"nextPageToken":null,"nextPageUrl":null,"total":1}},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null},"mute":{"isMutedByMe":false},"topics":{"canAssignTopics":true,"items":[{"createdDate":"2017-05-10T10:47:42.000Z","description":null,"id":"0TO6A000000Kz8LWAS","images":{"coverImageUrl":null,"featuredImageUrl":null},"isBeingDeleted":false,"name":"Google","nonLocalizedName":"Google","talkingAbout":1,"url":"/services/data/v36.0/connect/topics/0TO6A000000Kz8LWAS"}]}},"clientInfo":null,"createdDate":"2018-06-26T08:55:49.000Z","event":false,"feedElementType":"FeedItem","header":{"isRichText":null,"messageSegments":[{"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"reference":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"text":"Site Admin","type":"EntityLink"},{"text":"Archived","type":"Text"},{"motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"reference":{"id":"0056A000000YmVKQA0","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0"},"text":"Anubhav Gupta","type":"EntityLink"}],"text":"Site Admin — Anubhav Gupta"},"id":"0D56A00000aUXm2SAG","isDeleteRestricted":false,"modifiedDate":"2018-06-26T08:57:27.000Z","originalFeedItem":null,"parent":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0056A00000aUXm2SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"photoUrl":"https://c.na50.content.force.com/profilephoto/7296A000000XfG9/T","relativeCreatedDate":"1m ago","type":"TrackedChange","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG","visibility":"AllUsers"}';
		insert feedCacheObj;
        String query  = 'Select Id, People__r.Segment__c, People__r.User__c,People__r.User__r.UserName, People__r.User__r.timezonesidkey, User__r.languagelocalekey, '+
	    										' People__r.Full_Name__c, People__r.Email__c, People__c,People__r.First_Name__c, People__r.Last_Name__c From People_Preference__c ';
        NotificationHelper.BrandingInfo brandingInfo = new NotificationHelper.BrandingInfo();
        brandingInfo.header_backgroundColor = 'ffffff';
        brandingInfo.header_iconColor = 'c5c5c5';
        brandingInfo.footer_backgroundColor = 'f8f8f8';
        brandingInfo.footer_textColor = '333333';
        brandingInfo.header_preset = 'default';
        brandingInfo.footer_preset = 'default';    			
        App_Config__c appCon =  TestHelper.setupAppConfig();      
        BatchEmailDigest beDigestObj = new BatchEmailDigest(appCon, 1, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
		beDigestObj = new BatchEmailDigest(appCon, 7, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
		Test.stopTest();
		System.assert(true, 'Running as Expected');
	}
    
    @isTest static void testGetCacheFeedElement() {
        Test.startTest();
        EmailDigestBatchHelper.getCacheFeedElement('feedElementJson', new Set<String>{'ids'}, new Set<String>{'mentionGrpIds'}, 'feedItemId', true, 'feedCommentId', 'parentId');
        System.assert(true, 'Running as Expected');
        Test.stopTest();
    }
    
    @isTest static void testBatchEmailDigest2(){
		Test.startTest();
		init();  
        testUser = [select id from User where lastName='BatchEmailDigestTest_usr1' limit 1];
        peopleObj = [select id From People__c where User__c =:testUser.Id limit 1];
        Must_Read_Audit__c mustReadObj = TestHelper.createMustReadAudit( contentObj.Id, 'everyone' , peopleObj.id);
        mustReadObj.Removed_DateTime__c = null;
        mustReadObj.Expiry_DateTime__c = null;
        mustReadObj.Is_Deleted__c = false;
        update mustReadObj;
        cg = [select id from CollaborationGroup where name='BatchEmailDigestTest' limit 1];
		FeedItem feedItem = TestDataHandler.createFeedItem(cg.id,'PollPost');
        FeedComment feedComment = TestDataHandler.createFeedComment(feedItem.Id);
        Feed_Cache__c feedCacheObj = new Feed_Cache__c();
        feedCacheObj.parent_Id__c = cg.id;
        feedCacheObj.Mention_1__c = peopleObj.id;
        feedCacheObj.Feed_Id__c = feedItem.id;
        feedCacheObj.Feed_Data__c ='{"actor":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"testPhotoUrl","photoVersionId":"testPhotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","additionalLabel":"Archived","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","name":"Anubhav Gupta","reputation":null,"title":null,"type":"User"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"  ","type":"posted a file."},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"User","additionalLabel":"Archived"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"aaa"},"canShare":true,"capabilities":{"associatedActions":{"platformActionGroups":[]},"poll":{"totalVoteCount":1,"choices":[{"id":"testId","position":1,"text":"testText","voteCount":1,"voteCountRatio":1}]},"content":{"downloadUrl":"testDownloaadUrl","fileExtension":".txt","fileSize":"22","fileType":"text","id":"contentTestId","title":"testTitle"},"bookmarks":{"isBookmarkedByCurrentUser":false},"chatterLikes":{"isLikedByCurrentUser":false,"likesMessage":null,"myLike":null,"page":{"currentPageToken":0,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/chatter-likes/items","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0}},"comments":{"page":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/comments/items","items":[{"user":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"teststandardEmailPhotoUrl","photoVersionId":"testphotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"posted a file.","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","topicUrl":"/services/data/v36.0/connect/topics?q=Google&exactMatch=true","type":"Hashtag","url":"/services/data/v36.0/chatter/feed-elements?q=%23Google"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"hey there goog [Crossed-out text: work] @Anubhav Gupta  @Site Admin  #Google- aa- bb- cc- dd"},"capabilities":{"content":{"checksum":"f721d878ca69178d3aa198a7bbb93ffb","contentUrl":null,"description":null,"downloadUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/download/0686A000002ONOn?asPdf=false&operationContext=CHATTER","fileExtension":"jpg","fileSize":"128749","fileType":"Image - jpg","hasPdfPreview":false,"id":"0696A000002JpVaQAK","isInMyFileSync":false,"mimeType":"image/jpeg","renditionUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB120BY90&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl240By180":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB240BY180&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl720By480":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB720BY480&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","sharingOption":"Allowed","textPreview":null,"thumb120By90RenditionStatus":"Processing","thumb240By180RenditionStatus":"Processing","thumb720By480RenditionStatus":"Processing","title":"Lenovo-p780-camera-sample-10.jpg","versionId":"0686A000002ONOnQAO"},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null}},"clientInfo":null,"createdDate":"2018-06-26T08:57:27.000Z","feedElement":{"id":"0D56A00000aUXm2SAG","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG"},"id":"0D76A0000009csNSAQ","isDeleteRestricted":false,"likes":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/likes","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0},"likesMessage":null,"moderationFlags":null,"myLike":null,"parent":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"relativeCreatedDate":"Just now","type":"ContentComment","url":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ"}],"nextPageToken":null,"nextPageUrl":null,"total":1}},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null},"mute":{"isMutedByMe":false},"topics":{"canAssignTopics":true,"items":[{"createdDate":"2017-05-10T10:47:42.000Z","description":null,"id":"0TO6A000000Kz8LWAS","images":{"coverImageUrl":null,"featuredImageUrl":null},"isBeingDeleted":false,"name":"Google","nonLocalizedName":"Google","talkingAbout":1,"url":"/services/data/v36.0/connect/topics/0TO6A000000Kz8LWAS"}]}},"clientInfo":null,"createdDate":"2018-06-26T08:55:49.000Z","event":false,"feedElementType":"FeedItem","header":{"isRichText":null,"messageSegments":[{"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"reference":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"text":"Site Admin","type":"EntityLink"},{"text":"Archived","type":"Text"},{"motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"reference":{"id":"0056A000000YmVKQA0","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0"},"text":"Anubhav Gupta","type":"EntityLink"}],"text":"Site Admin — Anubhav Gupta"},"originalFeedItemActor":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"User","additionalLabel":"Archived"},"id":"0D56A00000aUXm2SAG","isDeleteRestricted":false,"modifiedDate":"2018-06-26T08:57:27.000Z","originalFeedItem":null,"parent":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"photoUrl":"https://c.na50.content.force.com/profilephoto/7296A000000XfG9/T","relativeCreatedDate":"1m ago","type":"TextPost","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG","visibility":"AllUsers"}';
		insert feedCacheObj;
        App_Default__c appDefaultObj = TestHelper.setupAppDefault();
        appDefaultObj.Type__c = 'home-default';
        update appDefaultObj;
        String query  = 'Select Id, People__r.Segment__c,People__r.User__c,People__r.User__r.UserName, People__r.User__r.timezonesidkey, User__r.languagelocalekey, '+
	    										' People__r.Full_Name__c, People__r.Email__c, People__c,People__r.First_Name__c, People__r.Last_Name__c From People_Preference__c ';
        NotificationHelper.BrandingInfo brandingInfo = new NotificationHelper.BrandingInfo();
        brandingInfo.header_backgroundColor = 'ffffff'; 
        brandingInfo.header_preset = 'dark';
        App_Config__c appCon =  TestHelper.setupAppConfig();      
		BatchEmailDigest beDigestObj = new BatchEmailDigest(appCon, 1, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
		System.assert(true, 'Running as Expected');
        Test.stopTest();
	}
    
    @isTest static void testBatchEmailDigest3(){
        Test.startTest();
		Simpplr_Content__c contentObj1 = [select id from Simpplr_Content__c where Type__c='Album' limit 1];
        testUser = [select id from User where lastName='BatchEmailDigestTest_usr1' limit 1];
        peopleObj = [select id From People__c where User__c =:testUser.Id limit 1];
        cg = [select id from CollaborationGroup where name='BatchEmailDigestTest' limit 1];
		FeedItem feedItem = TestDataHandler.createFeedItem(cg.id,'PollPost');
        FeedComment feedComment = TestDataHandler.createFeedComment(feedItem.Id);
        Feed_Cache__c feedCacheObj = new Feed_Cache__c();
        feedCacheObj.parent_Id__c = cg.id;
        feedCacheObj.Mention_1__c = peopleObj.id;
        feedCacheObj.Feed_Id__c = feedItem.id;
        feedCacheObj.Feed_Data__c = '{"actor":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0F96A000000UH93SAG","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"testPhotoUrl","photoVersionId":"testPhotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","additionalLabel":"Archived","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","name":"Anubhav Gupta","reputation":null,"title":null,"type":"User"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"  ","type":"posted a file."},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Archived"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Private"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"CollaborationGroup","additionalLabel":"Unlisted"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"aaa"},"canShare":true,"capabilities":{"associatedActions":{"platformActionGroups":[]},"files":{"items":[{"id":"'+contentObj1.id+'","url":"https://c.na136"}]},"link":{"url":"https://c.na136","urlName":"newURL"},"poll":{"totalVoteCount":1,"choices":[{"id":"testId","position":1,"text":"testText","voteCount":1,"voteCountRatio":1}]},"content":{"downloadUrl":"testDownloaadUrl","fileExtension":".txt","fileSize":"22","fileType":"text","id":"contentTestId","title":"testTitle"},"bookmarks":{"isBookmarkedByCurrentUser":false},"chatterLikes":{"isLikedByCurrentUser":false,"likesMessage":null,"myLike":null,"page":{"currentPageToken":0,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/chatter-likes/items","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0}},"comments":{"page":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/comments/items","items":[{"user":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"teststandardEmailPhotoUrl","photoVersionId":"testphotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"posted a file.","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Archived","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Unlisted","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Private","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"additionalLabel":"Private","motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"tag":"Google","text":"#Google","topicUrl":"/services/data/v36.0/connect/topics?q=Google&exactMatch=true","type":"Hashtag","url":"/services/data/v36.0/chatter/feed-elements?q=%23Google"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"hey there goog [Crossed-out text: work] @Anubhav Gupta  @Site Admin  #Google- aa- bb- cc- dd"},"capabilities":{"content":{"checksum":"f721d878ca69178d3aa198a7bbb93ffb","contentUrl":null,"description":null,"downloadUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/download/0686A000002ONOn?asPdf=false&operationContext=CHATTER","fileExtension":"jpg","fileSize":"128749","fileType":"Image - jpg","hasPdfPreview":false,"id":"0696A000002JpVaQAK","isInMyFileSync":false,"mimeType":"image/jpeg","renditionUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB120BY90&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl240By180":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB240BY180&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl720By480":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB720BY480&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","sharingOption":"Allowed","textPreview":null,"thumb120By90RenditionStatus":"Processing","thumb240By180RenditionStatus":"Processing","thumb720By480RenditionStatus":"Processing","title":"Lenovo-p780-camera-sample-10.jpg","versionId":"0686A000002ONOnQAO"},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null}},"clientInfo":null,"createdDate":"2018-06-26T08:57:27.000Z","feedElement":{"id":"0D56A00000aUXm2SAG","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG"},"id":"0D76A0000009csNSAQ","isDeleteRestricted":false,"likes":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/likes","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0},"likesMessage":null,"moderationFlags":null,"myLike":null,"parent":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"relativeCreatedDate":"Just now","type":"ContentComment","url":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ"}],"nextPageToken":null,"nextPageUrl":null,"total":1}},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null},"mute":{"isMutedByMe":false},"topics":{"canAssignTopics":true,"items":[{"createdDate":"2017-05-10T10:47:42.000Z","description":null,"id":"0TO6A000000Kz8LWAS","images":{"coverImageUrl":null,"featuredImageUrl":null},"isBeingDeleted":false,"name":"Google","nonLocalizedName":"Google","talkingAbout":1,"url":"/services/data/v36.0/connect/topics/0TO6A000000Kz8LWAS"}]}},"clientInfo":null,"createdDate":"2018-06-26T08:55:49.000Z","event":false,"feedElementType":"FeedItem","header":{"isRichText":null,"messageSegments":[{"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"reference":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"text":"Site Admin","type":"EntityLink"},{"text":"Archived","type":"Text"},{"motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"reference":{"id":"0056A000000YmVKQA0","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0"},"text":"Anubhav Gupta","type":"EntityLink"}],"text":"Site Admin — Anubhav Gupta"},"id":"0D56A00000aUXm2SAG","isDeleteRestricted":false,"modifiedDate":"2018-06-26T08:57:27.000Z","originalFeedItem":null,"parent":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0056A00000aUXm2SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"photoUrl":"https://c.na50.content.force.com/profilephoto/7296A000000XfG9/T","relativeCreatedDate":"1m ago","type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG","visibility":"AllUsers"}';
            insert feedCacheObj;
        String query  = 'Select Id, People__r.Segment__c,People__r.User__c,People__r.User__r.UserName, People__r.User__r.timezonesidkey, User__r.languagelocalekey, '+
	    										' People__r.Full_Name__c, People__r.Email__c, People__c,People__r.First_Name__c, People__r.Last_Name__c From People_Preference__c ';
        NotificationHelper.BrandingInfo brandingInfo = new NotificationHelper.BrandingInfo();
        brandingInfo.header_backgroundColor = 'ffffff';   			
        App_Config__c appCon =  TestHelper.setupAppConfig();      
        BatchEmailDigest beDigestObj = new BatchEmailDigest(appCon, 1, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
		System.assert(true, 'Running as Expected');
        Test.stopTest();
	}
    
    @isTest static void testBatchEmailDigest4(){
        Test.startTest();
		Simpplr_Content__c contentObj1 = [select id from Simpplr_Content__c where Type__c='Album' limit 1];
        testUser = [select id from User where lastName='BatchEmailDigestTest_usr1' limit 1];
        peopleObj = [select id From People__c where User__c =:testUser.Id limit 1];
        cg = [select id from CollaborationGroup where name='BatchEmailDigestTest' limit 1];
		FeedItem feedItem = TestDataHandler.createFeedItem(cg.id,'PollPost');
        FeedComment feedComment = TestDataHandler.createFeedComment(feedItem.Id);
        Feed_Cache__c feedCacheObj = new Feed_Cache__c();
        feedCacheObj.parent_Id__c = cg.id;
        feedCacheObj.Mention_1__c = peopleObj.id;
        feedCacheObj.Feed_Id__c = feedItem.id;
        feedCacheObj.Feed_Data__c = '{"actor":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"testPhotoUrl","photoVersionId":"testPhotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","additionalLabel":"Archived","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","name":"Anubhav Gupta","reputation":null,"title":null,"type":"User"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"  ","type":"posted a file."},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"User","additionalLabel":"Archived"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"aaa"},"canShare":true,"capabilities":{"associatedActions":{"platformActionGroups":[]},"poll":{"totalVoteCount":1,"choices":[{"id":"testId","position":1,"text":"testText","voteCount":1,"voteCountRatio":1}]},"content":{"downloadUrl":"testDownloaadUrl","fileExtension":".txt","fileSize":"22","fileType":"text","id":"contentTestId","title":"testTitle"},"bookmarks":{"isBookmarkedByCurrentUser":false},"chatterLikes":{"isLikedByCurrentUser":false,"likesMessage":null,"myLike":null,"page":{"currentPageToken":0,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/chatter-likes/items","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0}},"comments":{"page":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/comments/items","items":[{"user":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"teststandardEmailPhotoUrl","photoVersionId":"testphotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"posted a file.","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","topicUrl":"/services/data/v36.0/connect/topics?q=Google&exactMatch=true","type":"Hashtag","url":"/services/data/v36.0/chatter/feed-elements?q=%23Google"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"hey there goog [Crossed-out text: work] @Anubhav Gupta  @Site Admin  #Google- aa- bb- cc- dd"},"capabilities":{"content":{"checksum":"f721d878ca69178d3aa198a7bbb93ffb","contentUrl":null,"description":null,"downloadUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/download/0686A000002ONOn?asPdf=false&operationContext=CHATTER","fileExtension":"jpg","fileSize":"128749","fileType":"Image - jpg","hasPdfPreview":false,"id":"0696A000002JpVaQAK","isInMyFileSync":false,"mimeType":"image/jpeg","renditionUrl":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB120BY90&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl240By180":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB240BY180&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl720By480":"https://c.na50.content.force.com/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB720BY480&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","sharingOption":"Allowed","textPreview":null,"thumb120By90RenditionStatus":"Processing","thumb240By180RenditionStatus":"Processing","thumb720By480RenditionStatus":"Processing","title":"Lenovo-p780-camera-sample-10.jpg","versionId":"0686A000002ONOnQAO"},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null}},"clientInfo":null,"createdDate":"2018-06-26T08:57:27.000Z","feedElement":{"id":"0D56A00000aUXm2SAG","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG"},"id":"0D76A0000009csNSAQ","isDeleteRestricted":false,"likes":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/likes","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0},"likesMessage":null,"moderationFlags":null,"myLike":null,"parent":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"relativeCreatedDate":"Just now","type":"ContentComment","url":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ"}],"nextPageToken":null,"nextPageUrl":null,"total":1}},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null},"mute":{"isMutedByMe":false},"topics":{"canAssignTopics":true,"items":[{"createdDate":"2017-05-10T10:47:42.000Z","description":null,"id":"0TO6A000000Kz8LWAS","images":{"coverImageUrl":null,"featuredImageUrl":null},"isBeingDeleted":false,"name":"Google","nonLocalizedName":"Google","talkingAbout":1,"url":"/services/data/v36.0/connect/topics/0TO6A000000Kz8LWAS"}]}},"clientInfo":null,"createdDate":"2018-06-26T08:55:49.000Z","event":false,"feedElementType":"FeedItem","header":{"isRichText":null,"messageSegments":[{"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"reference":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"text":"Site Admin","type":"EntityLink"},{"text":"Archived","type":"Text"},{"motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"reference":{"id":"0056A000000YmVKQA0","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0"},"text":"Anubhav Gupta","type":"EntityLink"}],"text":"Site Admin — Anubhav Gupta"},"id":"0D56A00000aUXm2SAG","isDeleteRestricted":false,"modifiedDate":"2018-06-26T08:57:27.000Z","originalFeedItem":null,"parent":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"photoUrl":"https://c.na50.content.force.com/profilephoto/7296A000000XfG9/T","relativeCreatedDate":"1m ago","type":"TextPost","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG","visibility":"AllUsers"}';
		insert feedCacheObj;
        String query  = 'Select Id, People__r.Segment__c,People__r.User__c,People__r.User__r.UserName, People__r.User__r.timezonesidkey, User__r.languagelocalekey, '+
	    										' People__r.Full_Name__c, People__r.Email__c, People__c,People__r.First_Name__c, People__r.Last_Name__c From People_Preference__c ';
        NotificationHelper.BrandingInfo brandingInfo = new NotificationHelper.BrandingInfo();
        brandingInfo.header_preset = 'primary';
        brandingInfo.header_backgroundColor = 'ffffff';
        App_Config__c appCon =  TestHelper.setupAppConfig();      
        BatchEmailDigest beDigestObj = new BatchEmailDigest(appCon, 1, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
		System.assert(true, 'Running as Expected');
        Test.stopTest();
	}
    
    @isTest static void testgetEmailContentBody() {
        Test.startTest();
        NotificationHelper.BrandingInfo brandingInfo =  EmailUtility.getBrandingInfo4People(null);
        List<String> formatterList = new List<String>{'formatterList1', 'formatterList2'};
        JSONFeedElementWrapper.Content content = new JSONFeedElementWrapper.Content();
        content.downloadUrl = 'testDownloadUrl';
        content.fileExtension = '.txt';
        content.fileSize = '22';
        content.fileType = 'text';
        content.id = 'contentTestId';
        content.title = 'testTitle';
        EmailDigestBatchHelper.getEmailContentBody(content, formatterList, brandingInfo);
        System.assert(true, 'Running as Expected');
        Test.stopTest();
    }

    @isTest static void testBatchEmailDigestContentPost(){
        Test.startTest();
        init();
        Simpplr_Content__c contentObj1 = [select id from Simpplr_Content__c where Type__c='Album' limit 1];
        testUser = [select id from User where lastName='BatchEmailDigestTest_usr1' limit 1];
        peopleObj = [select id From People__c where User__c =:testUser.Id limit 1];
        cg = [select id from CollaborationGroup where name='BatchEmailDigestTest' limit 1];
        FeedItem feedItem = TestDataHandler.createFeedItem(contentObj1.id,'ContentPost');
        FeedComment feedComment = TestDataHandler.createFeedComment(feedItem.Id);
        Feed_Cache__c feedCacheObj = new Feed_Cache__c();
        feedCacheObj.parent_Id__c = contentObj1.id;
        feedCacheObj.Mention_1__c = peopleObj.id;
        feedCacheObj.Feed_Id__c = feedItem.id;
        feedCacheObj.Site__c = siteObj.id;
        feedCacheObj.Feed_Data__c = '{"actor":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"testPhotoUrl","photoVersionId":"testPhotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"CollaborationGroupCreated","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","additionalLabel":"Archived","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","name":"Anubhav Gupta","reputation":null,"title":null,"type":"User"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"  ","type":"posted a file."},{"accessible":true,"name":"Site Admin","record":{"displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","lastName":"Gupta","name":"Anubhav Gupta","type":"User","additionalLabel":"Archived"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","type":"Hashtag"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"aaa"},"canShare":true,"capabilities":{"associatedActions":{"platformActionGroups":[]},"poll":{"totalVoteCount":1,"choices":[{"id":"testId","position":1,"text":"testText","voteCount":1,"voteCountRatio":1}]},"content":{"downloadUrl":"testDownloaadUrl","fileExtension":".txt","fileSize":"22","fileType":"text","id":"contentTestId","title":"testTitle"},"bookmarks":{"isBookmarkedByCurrentUser":false},"chatterLikes":{"isLikedByCurrentUser":false,"likesMessage":null,"myLike":null,"page":{"currentPageToken":0,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/chatter-likes/items","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0}},"comments":{"page":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/comments/items","items":[{"user":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"photo":{"standardEmailPhotoUrl":"teststandardEmailPhotoUrl","photoVersionId":"testphotoVersionId"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"body":{"isRichText":true,"messageSegments":[{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupBegin"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupBegin"},{"text":"hey","type":"Text"},{"htmlTag":"u","markupType":"Underline","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupBegin"},{"text":"there","type":"Text"},{"htmlTag":"b","markupType":"Bold","text":"","type":"MarkupEnd"},{"text":" ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupBegin"},{"text":"goog ","type":"Text"},{"htmlTag":"i","markupType":"Italic","text":"","type":"MarkupEnd"},{"htmlTag":"s","markupType":"Strikethrough","text":"[Crossed-out text: ","type":"MarkupBegin"},{"text":"work","type":"Text"},{"htmlTag":"s","markupType":"Strikethrough","text":"]","type":"MarkupEnd"},{"text":" ","type":"Text"},{"accessible":true,"name":"Anubhav Gupta","record":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"text":"@Anubhav Gupta","type":"Mention"},{"text":"posted a file.","type":"Text"},{"text":"⁣﻿​﻿⁣﻿⁣_dd","type":"Text"},{"url":"provider=https://c.na136","type":"link"},{"accessible":true,"name":"Site Admin","record":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"text":"@Site Admin","type":"Mention"},{"text":"  ","type":"Text"},{"tag":"Google","text":"#Google","topicUrl":"/services/data/v36.0/connect/topics?q=Google&exactMatch=true","type":"Hashtag","url":"/services/data/v36.0/chatter/feed-elements?q=%23Google"},{"htmlTag":"p","markupType":"Paragraph","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"aa","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"bb","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ul","markupType":"UnorderedList","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupBegin"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"cc","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"li","markupType":"ListItem","text":"- ","type":"MarkupBegin"},{"text":"dd","type":"Text"},{"htmlTag":"li","markupType":"ListItem","text":"","type":"MarkupEnd"},{"htmlTag":"ol","markupType":"OrderedList","text":"","type":"MarkupEnd"}],"text":"hey there goog [Crossed-out text: work] @Anubhav Gupta  @Site Admin  #Google- aa- bb- cc- dd"},"capabilities":{"content":{"checksum":"f721d878ca69178d3aa198a7bbb93ffb","contentUrl":null,"description":null,"downloadUrl":"/sfc/servlet.shepherd/version/download/0686A000002ONOn?asPdf=false&operationContext=CHATTER","fileExtension":"jpg","fileSize":"128749","fileType":"Image - jpg","hasPdfPreview":false,"id":"0696A000002JpVaQAK","isInMyFileSync":false,"mimeType":"image/jpeg","renditionUrl":"/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB120BY90&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl240By180":"/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB240BY180&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","renditionUrl720By480":"/sfc/servlet.shepherd/version/renditionDownload?rendition=THUMB720BY480&versionId=0686A000002ONOn&operationContext=CHATTER&contentId=05T6A000009BEvT","sharingOption":"Allowed","textPreview":null,"thumb120By90RenditionStatus":"Processing","thumb240By180RenditionStatus":"Processing","thumb720By480RenditionStatus":"Processing","title":"Lenovo-p780-camera-sample-10.jpg","versionId":"0686A000002ONOnQAO"},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null}},"clientInfo":null,"createdDate":"2018-06-26T08:57:27.000Z","feedElement":{"id":"0D56A00000aUXm2SAG","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG"},"id":"0D76A0000009csNSAQ","isDeleteRestricted":false,"likes":{"currentPageToken":null,"currentPageUrl":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ/likes","items":[],"nextPageToken":null,"nextPageUrl":null,"previousPageToken":null,"previousPageUrl":null,"total":0},"likesMessage":null,"moderationFlags":null,"myLike":null,"parent":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"relativeCreatedDate":"Just now","type":"ContentComment","url":"/services/data/v36.0/chatter/comments/0D76A0000009csNSAQ"}],"nextPageToken":null,"nextPageUrl":null,"total":1}},"edit":{"isEditRestricted":false,"isEditableByMeUrl":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG/capabilities/edit/is-editable-by-me","lastEditedBy":null,"lastEditedDate":null,"latestRevision":1,"relativeLastEditedDate":null},"mute":{"isMutedByMe":false},"topics":{"canAssignTopics":true,"items":[{"createdDate":"2017-05-10T10:47:42.000Z","description":null,"id":"0TO6A000000Kz8LWAS","images":{"coverImageUrl":null,"featuredImageUrl":null},"isBeingDeleted":false,"name":"Google","nonLocalizedName":"Google","talkingAbout":1,"url":"/services/data/v36.0/connect/topics/0TO6A000000Kz8LWAS"}]}},"clientInfo":null,"createdDate":"2018-06-26T08:55:49.000Z","event":false,"feedElementType":"FeedItem","header":{"isRichText":null,"messageSegments":[{"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"reference":{"id":"0F96A000000UH93SAG","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG"},"text":"Site Admin","type":"EntityLink"},{"text":"Archived","type":"Text"},{"motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"reference":{"id":"0056A000000YmVKQA0","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0"},"text":"Anubhav Gupta","type":"EntityLink"}],"text":"Site Admin — Anubhav Gupta"},"id":"0D56A00000aUXm2SAG","isDeleteRestricted":false,"modifiedDate":"2018-06-26T08:57:27.000Z","originalFeedItem":null,"parent":{"announcement":null,"canHaveChatterGuests":false,"community":null,"description":null,"emailToChatterAddress":null,"id":"0F96A000000UH93SAG","isArchived":false,"isAutoArchiveDisabled":true,"isBroadcast":false,"lastFeedElementPostDate":"2018-06-26T08:55:49.000Z","memberCount":4,"motif":{"color":"83B6FF","largeIconUrl":"/img/icon/groups64.png","mediumIconUrl":"/img/icon/groups32.png","smallIconUrl":"/img/icon/groups16.png"},"myRole":"GroupOwner","mySubscription":{"id":"0FB6A000000GuGMWA0","url":"/services/data/v36.0/chatter/group-memberships/0FB6A000000GuGMWA0"},"name":"Site Admin","owner":{"communityNickname":"anubhav","companyName":"Wildcraft","displayName":"Anubhav Gupta","firstName":"Anubhav","id":"0056A000000YmVKQA0","isActive":true,"isInThisCommunity":true,"lastName":"Gupta","motif":{"color":"65CAE4","largeIconUrl":"/img/icon/profile64.png","mediumIconUrl":"/img/icon/profile32.png","smallIconUrl":"/img/icon/profile16.png"},"name":"Anubhav Gupta","reputation":null,"title":null,"type":"User","url":"/services/data/v36.0/chatter/users/0056A000000YmVKQA0","userType":"Internal"},"type":"CollaborationGroup","url":"/services/data/v36.0/chatter/groups/0F96A000000UH93SAG","visibility":"PublicAccess"},"photoUrl":"/profilephoto/7296A000000XfG9/T","relativeCreatedDate":"1m ago","type":"TextPost","url":"/services/data/v36.0/chatter/feed-elements/0D56A00000aUXm2SAG","visibility":"AllUsers"}';
        feedCacheObj.Group_Mention_1__c = cg.id+'0F9Dn000000DJEQKA40F9Dn000000D0GEKA00F9Dn000000DC2sKAG';
        insert feedCacheObj;
        String query  = 'Select Id, People__r.User__c, People__r.Segment__c, People__r.User__r.UserName, People__r.User__r.timezonesidkey, User__r.languagelocalekey, '+
                                                ' People__r.Full_Name__c, People__r.Email__c, People__c,People__r.First_Name__c, People__r.Last_Name__c From People_Preference__c ';
        NotificationHelper.BrandingInfo brandingInfo = new NotificationHelper.BrandingInfo();
        brandingInfo.header_preset = 'primary';
        brandingInfo.header_backgroundColor = 'ffffff';
        App_Config__c appCon =  TestHelper.setupAppConfig();
        BatchEmailDigest beDigestObj = new BatchEmailDigest(appCon, 1, query, new Map<String, NotificationHelper.BrandingInfo>{'default'=> brandingInfo});
        DataBase.executeBatch(beDigestObj);
        System.assert(true, 'Running as Expected');
        Test.stopTest();
    }
}